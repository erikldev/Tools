$Manter = @("Administrador","Public","Arklok")

$perfis = Get-CimInstance Win32_UserProfile | Where-Object {
    $_.LocalPath -like "C:\Users\*" -and
    ($Manter -notcontains (Split-Path $_.LocalPath -Leaf)) -and
    -not $_.Special
}

if ($perfis.Count -eq 0) {
    Write-Host "Nenhum perfil encontrado para remocao." -ForegroundColor Cyan
    return
}

Write-Host "=== PERFIS QUE SERAO REMOVIDOS ===" -ForegroundColor Red
$perfis | ForEach-Object { Write-Host "â€¢ $($_.LocalPath)" -ForegroundColor Yellow }

$confirmar = Read-Host "`nDigite 'OK' para remover ou Enter para cancelar"

if ($confirmar -ne 'OK') {
    Write-Host "Operacao cancelada." -ForegroundColor Cyan
    return
}

$Throttle = 8 # Ideal para NVMe 

$perfis | ForEach-Object -Parallel {

    try {
        Remove-CimInstance $_
    }
    catch {
        Write-Host "Erro ao remover $($_.LocalPath)"
    }

} -ThrottleLimit $Throttle

Write-Host "Remocao concluida!" -ForegroundColor Green
