$ManterFixos = @("Administrador","Public")

$perfis = Get-CimInstance Win32_UserProfile | Where-Object {
    $_.LocalPath -like "C:\Users\*" -and
    -not $_.Special -and
    (
        ($ManterFixos -notcontains (Split-Path $_.LocalPath -Leaf)) -and
        ((Split-Path $_.LocalPath -Leaf) -notlike "Arklok*")
    )
}

if (!$perfis) {
    Write-Host "Nenhum perfil encontrado para remocao." -ForegroundColor Cyan
    return
}

Write-Host "=== PERFIS QUE SERAO REMOVIDOS ===" -ForegroundColor Red
$perfis | ForEach-Object { Write-Host "â€¢ $($_.LocalPath)" -ForegroundColor Yellow }

$confirmar = Read-Host "`nDigite 'OK' para remover ou Enter para cancelar"

if ($confirmar -ne 'OK') {
    Write-Host "Operacao cancelada." -ForegroundColor Cyan
    return
}

foreach ($perfil in $perfis) {
    try {
        Remove-CimInstance $perfil
        Write-Host "Removido: $($perfil.LocalPath)" -ForegroundColor Green
    }
    catch {
        Write-Host "Erro ao remover $($perfil.LocalPath)" -ForegroundColor Red
    }
}

Write-Host "Remocao concluida!" -ForegroundColor Green
